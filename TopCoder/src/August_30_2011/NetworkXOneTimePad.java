package August_30_2011;

import java.util.ArrayList;
import java.util.HashSet;

import javax.swing.text.PlainDocument;

public class NetworkXOneTimePad {
	
	HashSet<String> keys = new HashSet<String>();
	
	public static void main ( String args[] ) {
		long start = System.currentTimeMillis();
		NetworkXOneTimePad t = new NetworkXOneTimePad();
		String p[] = {"00000000000000000000000000000000000000000000000000", "00000000000000000000000000000000000000000000000001", "00000000000000000000000000000000000000000000000010", "00000000000000000000000000000000000000000000000011", "00000000000000000000000000000000000000000000000100", "00000000000000000000000000000000000000000000000101", "00000000000000000000000000000000000000000000000110", "00000000000000000000000000000000000000000000000111", "00000000000000000000000000000000000000000000001000", "00000000000000000000000000000000000000000000001001", "00000000000000000000000000000000000000000000001010", "00000000000000000000000000000000000000000000001011", "00000000000000000000000000000000000000000000001100", "00000000000000000000000000000000000000000000001101", "00000000000000000000000000000000000000000000001110", "00000000000000000000000000000000000000000000001111", "00000000000000000000000000000000000000000000010000", "00000000000000000000000000000000000000000000010001", "00000000000000000000000000000000000000000000010010", "00000000000000000000000000000000000000000000010011", "00000000000000000000000000000000000000000000010100", "00000000000000000000000000000000000000000000010101", "00000000000000000000000000000000000000000000010110", "00000000000000000000000000000000000000000000010111", "00000000000000000000000000000000000000000000011000", "00000000000000000000000000000000000000000000011001", "00000000000000000000000000000000000000000000011010", "00000000000000000000000000000000000000000000011011", "00000000000000000000000000000000000000000000011100", "00000000000000000000000000000000000000000000011101", "00000000000000000000000000000000000000000000011110", "00000000000000000000000000000000000000000000011111", "00000000000000000000000000000000000000000000100000", "00000000000000000000000000000000000000000000100001", "00000000000000000000000000000000000000000000100010", "00000000000000000000000000000000000000000000100011", "00000000000000000000000000000000000000000000100100", "00000000000000000000000000000000000000000000100101", "00000000000000000000000000000000000000000000100110", "00000000000000000000000000000000000000000000100111", "00000000000000000000000000000000000000000000101000", "00000000000000000000000000000000000000000000101001", "00000000000000000000000000000000000000000000101010", "00000000000000000000000000000000000000000000101011", "00000000000000000000000000000000000000000000101100", "00000000000000000000000000000000000000000000101101", "00000000000000000000000000000000000000000000101110", "00000000000000000000000000000000000000000000101111", "00000000000000000000000000000000000000000000110000", "00000000000000000000000000000000000000000000110001"};
		String c[] = {"00000000000000000000000000000000000000000000000000", "00000000000000000000000000000000000000000000000001", "00000000000000000000000000000000000000000000000010", "00000000000000000000000000000000000000000000000011", "00000000000000000000000000000000000000000000000100", "00000000000000000000000000000000000000000000000101", "00000000000000000000000000000000000000000000000110", "00000000000000000000000000000000000000000000000111", "00000000000000000000000000000000000000000000001000", "00000000000000000000000000000000000000000000001001", "00000000000000000000000000000000000000000000001010", "00000000000000000000000000000000000000000000001011", "00000000000000000000000000000000000000000000001100", "00000000000000000000000000000000000000000000001101", "00000000000000000000000000000000000000000000001110", "00000000000000000000000000000000000000000000001111", "00000000000000000000000000000000000000000000010000", "00000000000000000000000000000000000000000000010001", "00000000000000000000000000000000000000000000010010", "00000000000000000000000000000000000000000000010011", "00000000000000000000000000000000000000000000010100", "00000000000000000000000000000000000000000000010101", "00000000000000000000000000000000000000000000010110", "00000000000000000000000000000000000000000000010111", "00000000000000000000000000000000000000000000011000", "00000000000000000000000000000000000000000000011001", "00000000000000000000000000000000000000000000011010", "00000000000000000000000000000000000000000000011011", "00000000000000000000000000000000000000000000011100", "00000000000000000000000000000000000000000000011101", "00000000000000000000000000000000000000000000011110", "00000000000000000000000000000000000000000000011111", "00000000000000000000000000000000000000000000100000", "00000000000000000000000000000000000000000000100001", "00000000000000000000000000000000000000000000100010", "00000000000000000000000000000000000000000000100011", "00000000000000000000000000000000000000000000100100", "00000000000000000000000000000000000000000000100101", "00000000000000000000000000000000000000000000100110", "00000000000000000000000000000000000000000000100111", "00000000000000000000000000000000000000000000101000", "00000000000000000000000000000000000000000000101001", "00000000000000000000000000000000000000000000101010", "00000000000000000000000000000000000000000000101011", "00000000000000000000000000000000000000000000101100", "00000000000000000000000000000000000000000000101101", "00000000000000000000000000000000000000000000101110", "00000000000000000000000000000000000000000000101111", "00000000000000000000000000000000000000000000110000", "00000000000000000000000000000000000000000000110001"};
		
		
		System.out.println(t.crack(p,c));
		long end = System.currentTimeMillis();
		System.out.println((end-start)+" ms");
	}
	
	public String getKey ( String plain , String cipher ) {
		String result = "";
		for ( int i = 0 ; i < plain.length() ; ++i ) {
			if ( plain.charAt(i) == '1' && cipher.charAt(i) == '0' ) {
				result += '1';
			}
			if ( plain.charAt(i) == '1' && cipher.charAt(i) == '1' ) {
				result += '0';
			}
			if ( plain.charAt(i) == '0' && cipher.charAt(i) == '1' ) {
				result += '1';
			}
			if ( plain.charAt(i) == '0' && cipher.charAt(i) == '0' ) {
				result += '0';
			}
		}
		return result;
	}
	
	public String getXOR ( String plain , String key ) {
		String result = "";
		for ( int i = 0 ; i < plain.length() ; ++i ) {
			result += plain.charAt(i) == key.charAt(i) ? "0" : "1";
		}
		return result;
	}
	
	public int crack(String[] plaintexts, String[] ciphertexts) {
		int counter = 0;
		for ( int i = 0 ; i < plaintexts.length ; ++i ) {
			if ( checkMaping(plaintexts, ciphertexts, i, 0) ) {
					++counter;
				}
		}
		return counter;
	}
	
	public boolean checkMaping ( String[] plaintexts, String[] ciphertexts , int i , int k ) {
		String key = getXOR(plaintexts[i],ciphertexts[k]);
		if ( keys.contains(key) ) {
			return false;
		}
		String possible[] = new String[plaintexts.length];
		for ( int m = 0 ; m < plaintexts.length ; ++m ) {
			possible[m] = getXOR(plaintexts[m], key);
		}
		for ( int m = 0 ; m < ciphertexts.length ; ++m ) {
			int p;
			for ( p = 0 ; p < possible.length ; ++p ) {
				if ( ciphertexts[m].equals(possible[p]) ) {
					break;
				}
			}
			if ( p == possible.length ) {
				return false;
			}
		}
		keys.add(key);
		return true;
	}

}
